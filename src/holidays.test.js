import { expect, test } from "@jest/globals";
import { getHolidays } from "./holidays";

test("should have api available (NetworkTest)", async () => {
  const holidays = await getHolidays();
  expect(holidays[0]).toHaveProperty("holiday");
  expect(holidays[0]).toHaveProperty("type");
  expect(holidays[0]).toHaveProperty("date");
});

test("should map response (MockTest)", async () => {
  global.fetch = jest.fn().mockResolvedValue({
    ok: true,
    text: () =>
      Promise.resolve(`
<table id=holidays-today-table class="table table--left table--inner-borders-rows table--full-width table--sticky table--holidaycountry" data-tad-control="HolidayCountry.Table"><thead><tr><th rowspan=2>Date</th><th rowspan=2>&nbsp;</th><th rowspan=2>Name</th><th rowspan=2>Type</th><th rowspan=2>Details</th></tr><tr></tr></thead><tbody><tr id=hol_jan ></tr><tr id=hol_feb ></tr><tr id=hol_mar ></tr><tr id=hol_apr ></tr><tr id=hol_may ></tr><tr id=tr5  data-mask=8388608 data-date=1714867200000><th class="nw" >May 5</th><td class="nw" >Sunday</td><td><a href="/holidays/canada/orthodox-easter-day">Orthodox Easter</a></td><td>Orthodox</td><td>&nbsp;</td></tr></tbody></table>
      <table id=holidays-table class="table table--left table--inner-borders-rows table--full-width table--sticky table--holidaycountry" data-tad-control="HolidayCountry.Table"><thead><tr><th rowspan=2>Date</th><th rowspan=2>&nbsp;</th><th rowspan=2>Name</th><th rowspan=2>Type</th><th rowspan=2>Details</th></tr><tr></tr></thead><tbody><tr id=hol_jan ></tr><tr id=hol_feb ></tr><tr id=hol_mar ></tr><tr id=hol_apr ></tr><tr id=tr4  data-mask=49152 data-date=1714435200000><th class="nw" >Apr 30</th><td class="nw" >Tuesday</td><td><a href="/holidays/canada/last-day-of-passover">Last day of Passover</a></td><td>Jewish holiday</td><td>&nbsp;</td></tr><tr id=hol_may ></tr><tr id=tr6  data-mask=8388608 data-date=1714694400000><th class="nw" >May 3</th><td class="nw" >Friday</td><td><a href="/holidays/canada/orthodox-good-friday">Orthodox Good Friday</a></td><td>Orthodox</td><td>&nbsp;</td></tr><tr id=tr7  data-mask=8388608 data-date=1714780800000><th class="nw" >May 4</th><td class="nw" >Saturday</td><td><a href="/holidays/canada/orthodox-holy-saturday">Orthodox Holy Saturday</a></td><td>Orthodox</td><td>&nbsp;</td></tr><tr id=tr8  data-mask=8388608 data-date=1714867200000><th class="nw" >May 5</th><td class="nw" >Sunday</td><td><a href="/holidays/canada/orthodox-easter-day">Orthodox Easter</a></td><td>Orthodox</td><td>&nbsp;</td></tr><tr id=tr9  data-mask=32768 data-date=1714953600000><th class="nw" >May 6</th><td class="nw" >Monday</td><td><a href="/holidays/canada/yom-hashoah">Yom HaShoah</a></td><td>Jewish commemoration</td><td>&nbsp;</td></tr><tr id=tr10  data-mask=8388608 data-date=1714953600000><th class="nw" >May 6</th><td class="nw" >Monday</td><td><a href="/holidays/canada/orthodox-easter-monday">Orthodox Easter Monday</a></td><td>Orthodox</td><td>&nbsp;</td></tr><tr id=tr11  data-mask=8192 data-date=1715212800000><th class="nw" >May 9</th><td class="nw" >Thursday</td><td><a href="/holidays/canada/ascension-day">Ascension Day</a></td><td>Christian</td><td>&nbsp;</td></tr><tr id=tr12  data-mask=16 data-date=1715472000000><th class="nw" >May 12</th><td class="nw" >Sunday</td><td><a href="/holidays/canada/mother-day">Mothers&#39; Day</a></td><td>Observance</td><td>&nbsp;</td></tr><tr id=tr13  data-mask=32768 data-date=1715644800000><th class="nw" >May 14</th><td class="nw" >Tuesday</td><td><a href="/holidays/canada/yom-haatzmaut">Yom HaAtzmaut</a></td><td>Jewish holiday</td><td>&nbsp;</td></tr><tr id=tr14  data-mask=8192 data-date=1716076800000><th class="nw" >May 19</th><td class="nw" >Sunday</td><td><a href="/holidays/canada/pentecost">Pentecost</a></td><td>Christian</td><td>&nbsp;</td></tr><tr id=tr15  data-mask=8192 data-date=1716163200000><th class="nw" >May 20</th><td class="nw" >Monday</td><td><a href="/holidays/canada/whit-monday">Whit Monday</a></td><td>Christian</td><td>&nbsp;</td></tr><tr id=tr16  data-mask=2 data-date=1716163200000><th class="nw" >May 20</th><td class="nw" >Monday</td><td><a href="/holidays/canada/national-patriots-day">National Patriots&#39; Day</a></td><td>Local holiday</td><td>Quebec</td></tr><tr id=tr17  data-mask=1 data-date=1716163200000><th class="nw" >May 20</th><td class="nw" >Monday</td><td><a href="/holidays/canada/victoria-day">Victoria Day</a></td><td>Statutory Holiday</td><td><span title="All except NS, PE, QC">All except <span title="Nova Scotia">NS</span>, <span title="Prince Edward Island">PE</span>, <span title=Quebec>QC</span></span></td></tr><tr id=tr18  data-mask=8192 data-date=1716681600000><th class="nw" >May 26</th><td class="nw" >Sunday</td><td><a href="/holidays/canada/trinity-sunday">Trinity Sunday</a></td><td>Christian</td><td>&nbsp;</td></tr><tr id=tr19  data-mask=32768 data-date=1716681600000><th class="nw" >May 26</th><td class="nw" >Sunday</td><td><a href="/holidays/canada/lag-b-omer">Lag B&#39;Omer</a></td><td>Jewish holiday</td><td>&nbsp;</td></tr><tr id=tr20  data-mask=8192 data-date=1717027200000><th class="nw" >May 30</th><td class="nw" >Thursday</td><td><a href="/holidays/canada/corpus-christi">Corpus Christi</a></td><td>Christian</td><td>&nbsp;</td></tr><tr id=hol_jun ></tr><tr id=tr22  data-mask=32768 data-date=1718150400000><th class="nw" >Jun 12</th><td class="nw" >Wednesday</td><td><a href="/holidays/canada/shavuot">Shavuot</a></td><td>Jewish holiday</td><td>&nbsp;</td></tr><tr id=tr23  data-mask=16 data-date=1718496000000><th class="nw" >Jun 16</th><td class="nw" >Sunday</td><td><a href="/holidays/canada/father-day">Fathers&#39; Day</a></td><td>Observance</td><td>&nbsp;</td></tr><tr id=tr24  data-mask=65536 data-date=1718582400000><th class="nw" >Jun 17</th><td class="nw" >Monday</td><td><a href="/holidays/canada/eid-al-adha">Eid al-Adha</a></td><td>Muslim</td><td>&nbsp;</td></tr><tr id=tr25  data-mask=256 data-date=1718916659000><th class="nw" >Jun 20</th><td class="nw" >Thursday</td><td><a href="/calendar/june-solstice.html">June Solstice</a></td><td>Season</td><td>&nbsp;</td></tr><tr id=tr26  data-mask=16 data-date=1718928000000><th class="nw" >Jun 21</th><td class="nw" >Friday</td><td><a href="/holidays/canada/national-aboriginal-day">National Indigenous Peoples Day</a></td><td>Observance</td><td>&nbsp;</td></tr><tr id=tr27  data-mask=2 data-date=1718928000000><th class="nw" >Jun 21</th><td class="nw" >Friday</td><td><a href="/holidays/canada/national-aboriginal-day">National Indigenous Peoples Day</a></td><td>Local holiday</td><td><span title="NT, Yukon"><span title="Northwest Territories">NT</span>, Yukon</span></td></tr><tr id=tr28  data-mask=2 data-date=1719187200000><th class="nw" >Jun 24</th><td class="nw" >Monday</td><td><a href="/holidays/canada/june-holiday-newfoundland">June Holiday</a></td><td>Local holiday</td><td><span title=NL><span title="Newfoundland and Labrador">NL</span></span></td></tr><tr id=tr29  data-mask=2 data-date=1719187200000><th class="nw" >Jun 24</th><td class="nw" >Monday</td><td><a href="/holidays/canada/st-jean-baptiste-day">St. Jean Baptiste Day</a></td><td>Local holiday</td><td>Quebec</td></tr></tbody></table>
        `),
  });
  const holidays = await getHolidays();
  expect(holidays).toHaveLength(14);
  expect(holidays[0]).toMatchObject({
    date: "May 9",
    holiday: "Ascension Day",
    type: "Christian",
  });
});
